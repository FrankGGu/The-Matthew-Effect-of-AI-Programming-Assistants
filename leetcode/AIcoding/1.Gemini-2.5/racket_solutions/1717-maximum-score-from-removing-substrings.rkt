(define (remove-pairs s c1 c2 val)
  (let loop ((chars (string->list s))
             (stack '())
             (current-score 0))
    (if (null? chars)
        (cons (list->string (reverse stack)) current-score)
        (let ((char (car chars)))
          (if (and (not (null? stack))
                   (eq? (car stack) c1)
                   (eq? char c2))
              (loop (cdr chars) (cdr stack) (+ current-score val))
              (loop (cdr chars) (cons char stack) current-score))))))

(define (maximum-score-from-removing-substrings s x y)
  (if (> x y)
      (let* ((result1 (remove-pairs s #\a #\b x))
             (remaining-s1 (car result1))
             (score1 (cdr result1)))
        (let* ((result2 (remove-pairs remaining-s1 #\b #\a y))
               (score2 (cdr result2)))
          (+ score1 score2)))
      (let* ((result1 (remove-pairs s #\b #\a y))
             (remaining-s1 (car result1))
             (score1 (cdr result1)))
        (let* ((result2 (remove-pairs remaining-s1 #\a #\b x))
               (score2 (cdr result2)))
          (+ score1 score2)))))