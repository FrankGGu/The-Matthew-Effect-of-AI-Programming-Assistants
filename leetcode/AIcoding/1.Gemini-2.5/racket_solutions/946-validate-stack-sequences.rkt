(define (validate-stack-sequences pushed popped)
  (let* ((stack '())
         (popped-vec (list->vector popped))
         (j 0)
         (len-popped (vector-length popped-vec)))
    (for-each (lambda (x)
                (set! stack (cons x stack))
                (let pop-loop ()
                  (when (and (not (null? stack))
                             (< j len-popped)
                             (equal? (car stack) (vector-ref popped-vec j)))
                    (set! stack (cdr stack))
                    (set! j (+ j 1))
                    (pop-loop))))
              pushed)
    (null? stack)))