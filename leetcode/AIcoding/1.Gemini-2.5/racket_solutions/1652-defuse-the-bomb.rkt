(define (decrypt code k)
  (let* ((n (length code))
         (result (make-list n 0)))
    (cond
      ((zero? k)
       result)
      ((positive? k)
       (for-each
        (lambda (i)
          (let loop ((j 1) (sum 0))
            (when (<= j k)
              (set! sum (+ sum (list-ref code (modulo (+ i j) n))))
              (loop (+ j 1) sum)))
          (list-set! result i sum))
        (range n))
       result)
      ((negative? k)
       (let ((abs-k (abs k)))
         (for-each
          (lambda (i)
            (let loop ((j 1) (sum 0))
              (when (<= j abs-k)
                (set! sum (+ sum (list-ref code (modulo (- i j) n))))
                (loop (+ j 1) sum)))
            (list-set! result i sum))
          (range n))
         result))))