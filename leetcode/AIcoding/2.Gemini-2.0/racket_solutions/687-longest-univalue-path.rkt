(define (longest-univalue-path root)
  (define (helper node parent-val)
    (if (null? node)
        '(0 0)
        (let* ((left-result (helper (->left node) (->val node)))
               (right-result (helper (->right node) (->val node)))
               (left-len (car left-result))
               (left-path (cadr left-result))
               (right-len (car right-result))
               (right-path (cadr right-result))
               (current-left-path (if (and (not (null? (->left node))) (= (->val (->left node)) (->val node)))
                                         (+ left-path 1)
                                         0))
               (current-right-path (if (and (not (null? (->right node))) (= (->val (->right node)) (->val node)))
                                          (+ right-path 1)
                                          0))
               (max-path (+ current-left-path current-right-path))
               (current-len (max left-len right-len max-path)))
          (list current-len
                (if (= (->val node) parent-val)
                    (max current-left-path current-right-path)
                    0)))))
  (car (helper root -1)))