(define (remove-duplicate-letters s)
  (let* ((counts (make-hash))
         (in-stack? (make-hash))
         (stack '()))
    (for ([c (string->list s)])
      (hash-update! counts c (Î» (v) (+ v 1)) 1))
    (for ([c (string->list s)])
      (hash-update! counts c (Î» (v) (- v 1)) 0)
      (unless (hash-ref in-stack? c #f)
        (while (and (not (null? stack))
                    (char>? (car stack) c)
                    (> (hash-ref counts (car stack)) 0))
          (let ([popped (car stack)])
            (set! stack (cdr stack))
            (hash-remove! in-stack? popped)))
        (set! stack (cons c stack))
        (hash-set! in-stack? c #t)))
    (list->string (reverse stack))))