(define (maximal-network-rank n roads)
  (define adj (make-vector n '()))
  (define degrees (make-vector n 0))
  (for-each (lambda (road)
              (let ((u (car road)) (v (cadr road)))
                (vector-set! adj u (cons v (vector-ref adj u)))
                (vector-set! adj v (cons u (vector-ref adj v)))
                (vector-set! degrees u (+ 1 (vector-ref degrees u)))
                (vector-set! degrees v (+ 1 (vector-ref degrees v)))))
            roads)
  (define (connected? u v)
    (member v (vector-ref adj u)))
  (define (calculate-rank u v)
    (let ((rank (+ (vector-ref degrees u) (vector-ref degrees v))))
      (if (connected? u v)
          (- rank 1)
          rank)))
  (define (max-rank)
    (let loop ((u 0) (max-r 0))
      (if (= u n)
          max-r
          (let loop2 ((v (+ u 1)) (max-r2 max-r))
            (if (= v n)
                (loop (+ u 1) max-r2)
                (loop2 (+ v 1) (max max-r2 (calculate-rank u v))))))))
  (max-rank))