(define (is-perfect-rectangle rectangles)
  (let* ((points (make-hash))
         (area 0)
         (min-x (inf))
         (min-y (inf))
         (max-x (-inf))
         (max-y (-inf)))
    (for ([rect rectangles])
      (let* ((x1 (list-ref rect 0))
             (y1 (list-ref rect 1))
             (x2 (list-ref rect 2))
             (y2 (list-ref rect 3)))
        (area (+ area (* (- x2 x1) (- y2 y1))))
        (min-x (min min-x x1))
        (min-y (min min-y y1))
        (max-x (max max-x x2))
        (max-y (max max-y y2))
        (define (update-point x y)
          (let ((key (cons x y)))
            (cond
              [(hash-has-key? points key)
               (hash-remove! points key)]
              [else
               (hash-set! points key #t)])))
        (update-point x1 y1)
        (update-point x1 y2)
        (update-point x2 y1)
        (update-point x2 y2)))
    (and (= (hash-count points) 4)
         (hash-has-key? points (cons min-x min-y))
         (hash-has-key? points (cons min-x max-y))
         (hash-has-key? points (cons max-x min-y))
         (hash-has-key? points (cons max-x max-y))
         (= area (* (- max-x min-x) (- max-y min-y))))))