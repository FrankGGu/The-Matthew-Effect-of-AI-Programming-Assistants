(define (game-of-life board)
  (let* ((m (length board))
         (n (length (car board))))
    (define (count-neighbors i j)
      (let loop ((di '(-1 -1 -1 0 0 1 1 1))
                 (dj '(-1 0 1 -1 1 -1 0 1))
                 (count 0))
        (cond
          ((null? di) count)
          (else
           (let ((ni (+ i (car di)))
                 (nj (+ j (car dj))))
             (loop (cdr di) (cdr dj)
                   (if (and (>= ni 0) (< ni m) (>= nj 0) (< nj n)
                            (or (= 1 (abs (list-ref (list-ref board ni) nj)))
                                (= -1 (abs (list-ref (list-ref board ni) nj)))))
                       (add1 count)
                       count)))))))
    (for* ((i (in-range m))
           (j (in-range n)))
      (let ((neighbors (count-neighbors i j))
            (cell (list-ref (list-ref board i) j)))
        (cond
          ((and (= cell 1) (or (< neighbors 2) (> neighbors 3)))
           (set! (list-ref (list-ref board i) j) -1))
          ((and (= cell 0) (= neighbors 3))
           (set! (list-ref (list-ref board i) j) 2)))))
    (for* ((i (in-range m))
           (j (in-range n)))
      (let ((cell (list-ref (list-ref board i) j)))
        (cond
          ((= cell -1) (set! (list-ref (list-ref board i) j) 0))
          ((= cell 2) (set! (list-ref (list-ref board i) j) 1)))))
    board))