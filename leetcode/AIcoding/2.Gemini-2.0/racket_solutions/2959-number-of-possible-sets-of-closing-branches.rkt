(define (number-of-possible-sets-of-closing-branches n m roads maxDistance)
  (let* ((adj (make-vector (add1 n) '()))
         (ans (box 0)))
    (for ([road roads])
      (let ((u (car road))
            (v (cadr road))
            (w (caddr road)))
        (set! (vector-ref adj u) (cons (list v w) (vector-ref adj u)))
        (set! (vector-ref adj v) (cons (list u w) (vector-ref adj v)))))

    (define (dijkstra start mask)
      (let ((dist (make-vector (add1 n) #inf.0)))
        (vector-set! dist start 0)
        (let ((pq (mutable-priority-queue <)))
          (enqueue! pq (cons 0 start))
          (let loop ()
            (if (empty? pq)
                dist
                (let* ((curr (dequeue! pq))
                       (d (car curr))
                       (u (cdr curr)))
                  (if (> d (vector-ref dist u))
                      (loop)
                      (for ([neighbor (vector-ref adj u)])
                        (let ((v (car neighbor))
                              (w (cadr neighbor)))
                          (if (and (bitwise-bit-set? mask (sub1 v))
                                  (< (+ d w) (vector-ref dist v)))
                              (begin
                                (vector-set! dist v (+ d w))
                                (enqueue! pq (cons (+ d w) v))))))
                  (loop)))))))

    (define (solve mask)
      (let loop ([i 1] [total 0])
        (if (> i n)
            (begin
              (set! (unbox ans) (add1 (unbox ans)))
              #t)
            (let ((dist (dijkstra i mask)))
              (let loop2 ([j 1] [valid #t])
                (if (> j n)
                    valid
                    (if (and (bitwise-bit-set? mask (sub1 j))
                             (< (vector-ref dist j) maxDistance))
                        (loop2 (add1 j) valid)
                        (if (not (bitwise-bit-set? mask (sub1 j)))
                            (loop2 (add1 j) valid)
                            (loop2 (add1 j) #f))))))))

    (for ([mask (range (expt 2 n))])
      (solve mask))

    (unbox ans)))