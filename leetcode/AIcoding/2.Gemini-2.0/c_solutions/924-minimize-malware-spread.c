#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int find(int *parent, int i) {
    if (parent[i] == i)
        return i;
    return parent[i] = find(parent, parent[i]);
}

void unite(int *parent, int *size, int a, int b) {
    a = find(parent, a);
    b = find(parent, b);
    if (a != b) {
        if (size[a] < size[b]) {
            int temp = a;
            a = b;
            b = temp;
        }
        parent[b] = a;
        size[a] += size[b];
    }
}

int minMalwareSpread(int** graph, int graphSize, int* graphColSize, int* initial, int initialSize){
    int *parent = (int*)malloc(sizeof(int) * graphSize);
    int *size = (int*)malloc(sizeof(int) * graphSize);
    for (int i = 0; i < graphSize; i++) {
        parent[i] = i;
        size[i] = 1;
    }

    for (int i = 0; i < graphSize; i++) {
        for (int j = i + 1; j < graphSize; j++) {
            if (graph[i][j] == 1) {
                unite(parent, size, i, j);
            }
        }
    }

    int *count = (int*)calloc(graphSize, sizeof(int));
    for (int i = 0; i < initialSize; i++) {
        count[find(parent, initial[i])]++;
    }

    int ans = -1, maxSaved = -1;
    for (int i = 0; i < initialSize; i++) {
        int root = find(parent, initial[i]);
        if (count[root] == 1) {
            if (size[root] > maxSaved) {
                maxSaved = size[root];
                ans = initial[i];
            } else if (size[root] == maxSaved && initial[i] < ans) {
                ans = initial[i];
            }
        }
    }

    if (ans == -1) {
        ans = initial[0];
        for (int i = 1; i < initialSize; i++) {
            if (initial[i] < ans) {
                ans = initial[i];
            }
        }
    }

    free(parent);
    free(size);
    free(count);

    return ans;
}