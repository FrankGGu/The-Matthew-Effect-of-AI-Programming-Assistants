int minMalwareSpread(int** graph, int graphSize, int* graphColSize, int* initial, int initialSize) {
    int n = graphSize;
    int* visited = (int*)calloc(n, sizeof(int));
    int* count = (int*)calloc(n, sizeof(int));
    int* infected = (int*)calloc(n, sizeof(int));
    int* isMalware = (int*)calloc(n, sizeof(int));

    for (int i = 0; i < initialSize; i++) {
        isMalware[initial[i]] = 1;
    }

    for (int i = 0; i < initialSize; i++) {
        int src = initial[i];
        int* queue = (int*)malloc(n * sizeof(int));
        int front = 0, rear = 0;
        visited[src] = 1;
        queue[rear++] = src;

        while (front < rear) {
            int node = queue[front++];
            for (int j = 0; j < n; j++) {
                if (graph[node][j] && !visited[j]) {
                    visited[j] = 1;
                    queue[rear++] = j;
                    if (isMalware[j]) {
                        count[node]++;
                    }
                }
            }
        }

        for (int j = 0; j < n; j++) {
            if (visited[j]) {
                infected[j] += count[src];
            }
        }

        memset(visited, 0, n * sizeof(int));
    }

    int result = -1;
    int maxSafeNodes = -1;

    for (int i = 0; i < initialSize; i++) {
        int src = initial[i];
        if (infected[src] > maxSafeNodes || (infected[src] == maxSafeNodes && (result == -1 || src < result))) {
            maxSafeNodes = infected[src];
            result = src;
        }
    }

    free(visited);
    free(count);
    free(infected);
    free(isMalware);
    return result;
}