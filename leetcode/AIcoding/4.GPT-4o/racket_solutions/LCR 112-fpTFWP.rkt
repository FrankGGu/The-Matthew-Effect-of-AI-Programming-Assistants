(define (longest-increasing-path matrix)
  (define (dfs i j)
    (if (hash-has-key? memo (cons i j))
        (hash-ref memo (cons i j))
        (begin
          (define max-path 1)
          (for ([d '((1 0) (0 1) (-1 0) (0 -1))])
            (define new-i (+ i (car d)))
            (define new-j (+ j (cadr d)))
            (when (and (>= new-i 0) (< new-i (vector-length matrix))
                       (>= new-j 0) (< new-j (vector-length (vector-ref matrix new-i)))
                       (> (vector-ref (vector-ref matrix new-i) new-j)
                          (vector-ref (vector-ref matrix i) j)))
              (set! max-path (max max-path (+ 1 (dfs new-i new-j))))))
          (hash-set! memo (cons i j) max-path)
          max-path)))

  (define memo (make-hash))
  (if (null? matrix)
      0
      (define rows (vector-length matrix))
      (define cols (vector-length (vector-ref matrix 0)))
      (define result 0)
      (for ([i (in-range rows)])
        (for ([j (in-range cols)])
          (set! result (max result (dfs i j)))))
      result)))

(longest-increasing-path (vector (vector 9 9 4) (vector 6 6 8) (vector 2 1 1) (vector 1 1 1)))