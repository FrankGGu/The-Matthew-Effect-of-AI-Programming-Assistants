(define (maxFrequency nums k)
  (define (helper arr k)
    (define sorted-nums (sort arr <))
    (define (can-increase mid)
      (let loop ((l 0) (r 0) (sum 0) (count 0))
        (if (< r (length sorted-nums))
            (begin
              (set! sum (+ sum (list-ref sorted-nums r)))
              (set! count (+ count 1))
              (if (>= (* count (list-ref sorted-nums r)) (+ sum mid))
                  (if (<= (- sum mid) k)
                      (loop l (+ r 1) sum count)
                      (begin
                        (set! sum (- sum (list-ref sorted-nums l)))
                        (set! count (- count 1))
                        (loop (+ l 1) r sum count)))
                  (loop l (+ r 1) sum count)))
            count)))
    (define n (length sorted-nums))
    (define max-count 0)
    (for ((i (in-range n)))
      (let ((count (can-increase (list-ref sorted-nums i))))
        (set! max-count (max max-count count))))
    max-count)
  (helper nums k))