(define (find-anagrams s p)
  (define p-len (string-length p))
  (define s-len (string-length s))
  (define (char-count str)
    (let loop ((i 0) (counts (make-vector 26 0)))
      (if (< i (string-length str))
          (begin
            (vector-set! counts (- (char->integer (string-ref str i)) (char->integer #\a)) 1)
            (loop (+ i 1) counts)
            counts)))
      (vector->list counts))

  (define p-count (char-count p))
  (define s-count (char-count (substring s 0 (min p-len s-len))))
  (define result '())

  (define (matches? a b)
    (and (equal? (vector-ref a 0) (vector-ref b 0))
         (equal? (vector-ref a 1) (vector-ref b 1))
         (equal? (vector-ref a 2) (vector-ref b 2))
         (equal? (vector-ref a 3) (vector-ref b 3))
         (equal? (vector-ref a 4) (vector-ref b 4))
         (equal? (vector-ref a 5) (vector-ref b 5))
         (equal? (vector-ref a 6) (vector-ref b 6))
         (equal? (vector-ref a 7) (vector-ref b 7))
         (equal? (vector-ref a 8) (vector-ref b 8))
         (equal? (vector-ref a 9) (vector-ref b 9))
         (equal? (vector-ref a 10) (vector-ref b 10))
         (equal? (vector-ref a 11) (vector-ref b 11))
         (equal? (vector-ref a 12) (vector-ref b 12))
         (equal? (vector-ref a 13) (vector-ref b 13))
         (equal? (vector-ref a 14) (vector-ref b 14))
         (equal? (vector-ref a 15) (vector-ref b 15))
         (equal? (vector-ref a 16) (vector-ref b 16))
         (equal? (vector-ref a 17) (vector-ref b 17))
         (equal? (vector-ref a 18) (vector-ref b 18))
         (equal? (vector-ref a 19) (vector-ref b 19))
         (equal? (vector-ref a 20) (vector-ref b 20))
         (equal? (vector-ref a 21) (vector-ref b 21))
         (equal? (vector-ref a 22) (vector-ref b 22))
         (equal? (vector-ref a 23) (vector-ref b 23))
         (equal? (vector-ref a 24) (vector-ref b 24))
         (equal? (vector-ref a 25) (vector-ref b 25))))

  (for ((i (in-range (+ 1 (- s-len p-len)))))
    (when (matches? s-count p-count)
      (set! result (cons i result)))
    (when (< (+ i p-len) s-len)
      (vector-set! s-count (- (char->integer (string-ref s (+ i p-len))) (char->integer #\a)) 1)
      (vector-set! s-count (- (char->integer (string-ref s i)) (char->integer #\a)) -1)))

  (reverse result))

(find-anagrams "cbaebabacd" "abc")