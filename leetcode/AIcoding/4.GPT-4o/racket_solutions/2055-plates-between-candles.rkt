(define (platesBetweenCandles s queries)
  (define n (string-length s))
  (define prefix (make-vector (+ n 1) 0))
  (define left (make-vector n -1))
  (define right (make-vector n -1))

  (for ([i (in-range n)])
    (vector-set! prefix (+ i 1) (+ (vector-ref prefix i) (if (string-ref s i) 0 1)))
    (when (eq? (string-ref s i) #\|) 
      (set! (vector-ref left i) i))
    (when (and (eq? (string-ref s i) #\|) (not (= i 0)))
      (set! (vector-ref left i) (vector-ref left (- i 1)))))

  (for ([i (in-range (- n 1) -1 -1)])
    (when (eq? (string-ref s i) #\|) 
      (set! (vector-ref right i) i))
    (when (and (eq? (string-ref s i) #\|) (not (= i (- n 1))))
      (set! (vector-ref right i) (vector-ref right (+ i 1)))))

  (map (lambda (query)
         (let ([left-candle (vector-ref left (car query))])
           (let ([right-candle (vector-ref right (cdr query))])
             (if (and (not (= left-candle -1)) (not (= right-candle -1)) (< left-candle right-candle))
                 (- right-candle left-candle 1 (- (vector-ref prefix right-candle) (vector-ref prefix left-candle)))
                 0)))))
       queries))

(define s "**|**|***|")
(define queries '((2 5) (5 9) (0 4) (1 1)))
(platesBetweenCandles s queries)