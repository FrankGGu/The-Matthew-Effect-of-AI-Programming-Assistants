(define (MedianFinder)
  (define max-heap (make-vector 0))
  (define min-heap (make-vector 0))

  (define (add-number num)
    (vector-set! max-heap (vector-length max-heap) num)
    (set! max-heap (vector-sort (lambda (a b) (> a b)) max-heap))
    (let ((max-root (vector-ref max-heap 0)))
      (if (and (> (vector-length max-heap) 0)
               (and (> (vector-length min-heap) 0)
                    (> max-root (vector-ref min-heap 0))))
          (let ((moved (vector-ref max-heap 0)))
            (vector-set! max-heap 0 (vector-ref min-heap 0))
            (vector-set! min-heap 0 moved)
            (set! min-heap (vector-sort < min-heap))))
      (if (> (vector-length max-heap) (+ (vector-length min-heap) 1))
          (let ((moved (vector-ref max-heap 0)))
            (vector-set! max-heap 0 (vector-ref max-heap 1))
            (set! max-heap (vector-subvector max-heap 0 (sub1 (vector-length max-heap))))
            (vector-set! min-heap (vector-length min-heap) moved)
            (set! min-heap (vector-sort < min-heap))))
      (if (> (vector-length min-heap) (+ (vector-length max-heap)))
          (let ((moved (vector-ref min-heap 0)))
            (vector-set! min-heap 0 (vector-ref min-heap 1))
            (set! min-heap (vector-subvector min-heap 0 (sub1 (vector-length min-heap))))
            (vector-set! max-heap (vector-length max-heap) moved)
            (set! max-heap (vector-sort (lambda (a b) (> a b)) max-heap)))))

  (define (find-median)
    (if (= (vector-length max-heap) (vector-length min-heap))
        (/ (+ (vector-ref max-heap 0) (vector-ref min-heap 0)) 2.0)
        (if (> (vector-length max-heap) (vector-length min-heap))
            (vector-ref max-heap 0)
            (vector-ref min-heap 0))))

  (define (add-number-method num)
    (add-number num))

  (define (find-median-method)
    (find-median))

  (define (get-methods)
    (list add-number-method find-median-method))

  (get-methods))