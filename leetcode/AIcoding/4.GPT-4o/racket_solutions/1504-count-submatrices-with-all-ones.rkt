(define (num-submatrices-with-all-ones matrix)
  (let* ((rows (length matrix))
         (cols (if (zero? rows) 0 (length (vector-ref matrix 0))))
         (count 0)
         (heights (make-vector cols 0)))
    (for ((i 0 rows))
      (for ((j 0 cols))
        (if (= (vector-ref (vector-ref matrix i) j) 1)
            (vector-set! heights j (+ 1 (vector-ref heights j)))
            (vector-set! heights j 0)))
      (for ((j 0 cols))
        (let ((h (vector-ref heights j)))
          (for ((k 0 h))
            (set! count (+ count (- h k)))))))
    count))

(define (count-submatrices-with-all-ones matrix)
  (num-submatrices-with-all-ones matrix))