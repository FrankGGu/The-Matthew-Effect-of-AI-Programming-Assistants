(define (countPairs n edges distance)
  (define graph (make-vector n '()))
  (for-each (lambda (edge)
              (let ((u (car edge))
                    (v (cadr edge)))
                (vector-set! graph u (cons v (vector-ref graph u)))
                (vector-set! graph v (cons u (vector-ref graph v)))))
            edges)

  (define (dfs node parent depth)
    (if (>= depth distance)
        (list 0)
        (let loop ((children (vector-ref graph node))
                   (count 1) (depths (list 1)))
          (if (null? children)
              depths
              (let* ((child (car children))
                     (next-children (cdr children))
                     (child-depths (dfs child node (+ depth 1))))
                (set! count (+ count (car child-depths)))
                (set! depths (map (lambda (x) (+ 1 x)) (cdr child-depths)))
                (loop next-children count depths))))))

  (define (countPairsHelper node parent)
    (let* ((depths (dfs node parent 0))
           (pairs (apply + (map (lambda (x) (* x (- n x))) (cdr depths)))))
      pairs))

  (apply + (map (lambda (i) (countPairsHelper i -1)) (range n))))