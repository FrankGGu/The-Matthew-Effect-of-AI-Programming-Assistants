(define (repeatLimitedString s repeatLimit)
  (define freq (make-vector 26 0))
  (for-each (lambda (char) (vector-set! freq (- (char->integer char) (char->integer #\a)) (+ 1 (vector-ref freq (- (char->integer char) (char->integer #\a))))))
            s)
  (define sorted (sort (for/list ([i (in-range 26)]) (if (> (vector-ref freq i) 0) (values i (vector-ref freq i)) #f)) #:key second #:descending #t))
  (define result "")
  (define last-char #\0)
  (define last-count 0)

  (define (build)
    (for ([i (in-range (length sorted))])
      (define index (car (list-ref sorted i)))
      (define count (cdr (list-ref sorted i)))
      (when (> count 0)
        (if (and (equal? last-char index) (< last-count repeatLimit))
            (begin
              (when (not (= (add1 i) (length sorted)))
                (define next-index (car (list-ref sorted (add1 i))))
                (set! result (string-append result (string (integer->char next-index))))
                (vector-set! freq next-index (sub1 (vector-ref freq next-index)))
                (set! last-char next-index)
                (set! last-count 1))
              (if (< last-count repeatLimit)
                  (begin
                    (set! result (string-append result (string (integer->char index))))
                    (vector-set! freq index (sub1 (vector-ref freq index)))
                    (set! last-count (add1 last-count)))
                  (set! last-count 0)))
            (begin
              (set! result (string-append result (string (integer->char index))))
              (vector-set! freq index (sub1 (vector-ref freq index)))
              (set! last-char index)
              (set! last-count 1)))))
    (if (not (string-empty? result))
        (begin
          (set! last-char #\0)
          (set! last-count 0)
          (build)
          result)
        result))

  (build))