#lang racket

(define (make-number-container)
  (let ([index-map (hash)] [number-map (hash)])
    (lambda (msg . args)
      (cond
        [(eq? msg 'change)
         (let ([index (car args)] [number (cadr args)])
           (when (hash-has-key? index-map index)
             (let ([old-number (hash-ref index-map index)])
               (hash-update! number-map old-number (位 (v) (- v 1)) 0)))
           (hash-set! index-map index number)
           (hash-update! number-map number (位 (v) (+ v 1)) 0))]
        [(eq? msg 'find)
         (let ([index (car args)])
           (hash-ref index-map index #f))]
        [(eq? msg 'get-incremented-number)
         (let ([index (car args)])
           (let ([current (hash-ref index-map index #f)])
             (if current
                 (let ([count (hash-ref number-map current 0)])
                   (if (> count 1)
                       (begin
                         (hash-update! number-map current (位 (v) (- v 1)) 0)
                         (hash-update! number-map (add1 current) (位 (v) (+ v 1)) 0)
                         (hash-set! index-map index (add1 current))
                         (add1 current))
                       current))
                 #f)))]
        [else #f]))))

(define (main)
  (define container (make-number-container))
  (container 'change 1 1)
  (container 'change 2 1)
  (container 'change 3 1)
  (container 'change 4 2)
  (container 'change 5 2)
  (container 'change 6 2)
  (container 'change 7 3)
  (container 'change 8 3)
  (container 'change 9 3)
  (container 'change 10 3)
  (container 'change 11 4)
  (container 'change 12 4)
  (container 'change 13 4)
  (container 'change 14 4)
  (container 'change 15 4)
  (container 'change 16 5)
  (container 'change 17 5)
  (container 'change 18 5)
  (container 'change 19 5)
  (container 'change 20 5)
  (container 'change 21 5)
  (container 'change 22 6)
  (container 'change 23 6)
  (container 'change 24 6)
  (container 'change 25 6)
  (container 'change 26 6)
  (container 'change 27 6)
  (container 'change 28 6)
  (container 'change 29 7)
  (container 'change 30 7)
  (container 'change 31 7)
  (container 'change 32 7)
  (container 'change 33 7)
  (container 'change 34 7)
  (container 'change 35 7)
  (container 'change 36 7)
  (container 'change 37 8)
  (container 'change 38 8)
  (container 'change 39 8)
  (container 'change 40 8)
  (container 'change 41 8)
  (container 'change 42 8)
  (container 'change 43 8)
  (container 'change 44 8)
  (container 'change 45 8)
  (container 'change 46 9)
  (container 'change 47 9)
  (container 'change 48 9)
  (container 'change 49 9)
  (container 'change 50 9)
  (container 'change 51 9)
  (container 'change 52 9)
  (container 'change 53 9)
  (container 'change 54 9)
  (container 'change 55 9)
  (container 'change 56 10)
  (container 'change 57 10)
  (container 'change 58 10)
  (container 'change 59 10)
  (container 'change 60 10)
  (container 'change 61 10)
  (container 'change 62 10)
  (container 'change 63 10)
  (container 'change 64 10)
  (container 'change 65 10)
  (container 'change 66 10)
  (container 'change 67 10)
  (container 'change 68 10)
  (container 'change 69 10)
  (container 'change 70 10)
  (container 'change 71 10)
  (container 'change 72 10)
  (container 'change 73 10)
  (container 'change 74 10)
  (container 'change 75 10)
  (container 'change 76 10)
  (container 'change 77 10)
  (container 'change 78 10)
  (container 'change 79 10)
  (container 'change 80 10)
  (container 'change 81 10)
  (container 'change 82 10)
  (container 'change 83 10)
  (container 'change 84 10)
  (container 'change 85 10)
  (container 'change 86 10)
  (container 'change 87 10)
  (container 'change 88 10)
  (container 'change 89 10)
  (container 'change 90 10)
  (container 'change 91 10)
  (container 'change 92 10)
  (container 'change 93 10)
  (container 'change 94 10)
  (container 'change 95 10)
  (container 'change 96 10)
  (container 'change 97 10)
  (container 'change 98 10)
  (container 'change 99 10)
  (container 'change 100 10))
  (void))

(main)