(define (contains-duplicate-iii nums k t)
  (define (abs x) (if (< x 0) (- x) x))
  (define (get-bucket-id x) (quotient x t))
  (define (bucket-map)
    (let ([map (make-hash)])
      (lambda (x)
        (let ([id (get-bucket-id x)])
          (hash-set! map id x)
          id))))
  (let ([bucket-map (bucket-map)])
    (for/fold ([prev-map (hash)]) ([i (in-range (length nums))])
      (let ([x (list-ref nums i)])
        (let ([id (get-bucket-id x)])
          (when (and (hash-has-key? prev-map id)
                     (<= (abs (- x (hash-ref prev-map id))) t))
            (error "true"))
          (when (hash-has-key? prev-map (- id 1))
            (when (<= (abs (- x (hash-ref prev-map (- id 1)))) t)
              (error "true")))
          (when (hash-has-key? prev-map (+ id 1))
            (when (<= (abs (- x (hash-ref prev-map (+ id 1)))) t)
              (error "true")))
          (hash-set! prev-map id x)
          (when (>= i k)
            (hash-remove! prev-map (get-bucket-id (list-ref nums (- i k)))))
          prev-map)))
    #f))