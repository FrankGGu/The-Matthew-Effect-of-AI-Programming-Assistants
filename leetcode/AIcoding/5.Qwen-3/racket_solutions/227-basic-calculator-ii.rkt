#lang racket

(define (calculate s)
  (define (helper i sign stack)
    (if (>= i (string-length s))
        (apply + stack)
        (let ((c (string-ref s i)))
          (if (char=? c #\space)
              (helper (+ i 1) sign stack)
              (if (or (char=? c #\+) (char=? c #\-) (char=? c #\*) (char=? c #\/))
                  (helper (+ i 1) c (cons (if (char=? sign #\+) (car stack) (- (car stack))) (cdr stack)))
                  (let ((num (string->number (substring s i (find-next-op i)))))
                    (if (char=? sign #\+)
                        (helper (find-next-op i) #\+ (cons num stack))
                        (helper (find-next-op i) #\+ (cons (- num) stack))))))))
  (define (find-next-op i)
    (let loop ((i i))
      (if (or (>= i (string-length s)) (char=? (string-ref s i) #\+) (char=? (string-ref s i) #\-) (char=? (string-ref s i) #\*) (char=? (string-ref s i) #\/))
          i
          (loop (+ i 1)))))
  (helper 0 #\+ '()))

(define (main)
  (displayln (calculate "3+2*2"))
  (displayln (calculate " 3/2 "))
  (displayln (calculate " 1+2*5-3+4 "))
  (displayln (calculate "1+2*5-3+4/2"))
  (displayln (calculate " 1000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000+2000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000+2000000000+2000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000+2000000000+2000000000+2000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000 "))
  (displayln (calculate " 2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000+2000000000 ")))

(main)