#include <stdlib.h> // For malloc, free

static inline int minOfThree(int a, int b, int c) {
    int min_val = a;
    if (b < min_val) {
        min_val = b;
    }
    if (c < min_val) {
        min_val = c;
    }
    return min_val;
}

int nthUglyNumber(int n) {
    if (n <= 0) {
        return 0;
    }

    int* dp = (int*)malloc(sizeof(int) * n);
    if (dp == NULL) {
        // Handle memory allocation failure, though LeetCode usually assumes success
        return -1; 
    }

    dp[0] = 1;
    int p2 = 0; // Pointer for the next multiple of 2
    int p3 = 0; // Pointer for the next multiple of 3
    int p5 = 0; // Pointer for the next multiple of 5

    for (int i = 1; i < n; ++i) {
        int next2 = dp[p2] * 2;
        int next3 = dp[p3] * 3;
        int next5 = dp[p5] * 5;

        dp[i] = minOfThree(next2, next3, next5);

        // Advance pointers if their product was chosen as the next ugly number
        // Use separate if statements, not else if, because the same number
        // could be generated by multiple factors (e.g., 6 = 2*3 = 3*2)
        if (dp[i] == next2) {
            p2++;
        }
        if (dp[i] == next3) {
            p3++;
        }
        if (dp[i] == next5) {
            p5++;
        }
    }

    int result = dp[n - 1];
    free(dp); // Free the allocated memory

    return result;
}