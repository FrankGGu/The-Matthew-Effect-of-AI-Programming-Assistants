(define (count-valid-clock-times num)
  (define (match-char pattern-char value-char)
    (or (char=? pattern-char #\?)
        (char=? pattern-char value-char)))

  (define (count-valid-parts pattern-str max-val)
    (let ((p0 (string-ref pattern-str 0))
          (p1 (string-ref pattern-str 1)))
      (let loop ((i 0) (count 0))
        (if (> i max-val)
            count
            (let* ((s (number->string i))
                   (s-padded (if (< i 10) (string-append "0" s) s))
                   (v0 (string-ref s-padded 0))
                   (v1 (string-ref s-padded 1)))
              (if (and (match-char p0 v0)
                       (match-char p1 v1))
                  (loop (+ i 1) (+ count 1))
                  (loop (+ i 1) count)))))))

  (let* ((hours-pattern (substring num 0 2))
         (minutes-pattern (substring num 3 5))
         (num-valid-hours (count-valid-parts hours-pattern 23))
         (num-valid-minutes (count-valid-parts minutes-pattern 59)))
    (* num-valid-hours num-valid-minutes)))