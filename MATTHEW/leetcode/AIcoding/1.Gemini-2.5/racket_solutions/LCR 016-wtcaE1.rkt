(define (length-of-longest-substring s)
  (define n (string-length s))
  (if (= n 0)
      0
      (let ((max-len 0)
            (left 0)
            (char-map (make-hash)))
        (for ([right (in-range n)])
          (let ((current-char (string-ref s right)))
            (if (hash-has-key? char-map current-char)
                (let loop-shrink ((l left))
                  (when (not (char=? (string-ref s l) current-char))
                    (hash-remove! char-map (string-ref s l))
                    (loop-shrink (+ l 1)))
                  (hash-remove! char-map (string-ref s l))
                  (set! left (+ l 1))))
            (hash-set! char-map current-char #t)
            (set! max-len (max max-len (- (+ right 1) left)))))
        max-len)))