#lang racket

(define (find! parent i)
  (let ((p_i (vector-ref parent i)))
    (if (= p_i i)
        i
        (let ((root (find! parent p_i)))
          (vector-set! parent i root)
          root))))

(define (union! parent size i j)
  (let ((root-i (find! parent i))
        (root-j (find! parent j)))
    (unless (= root-i root-j)
      (when (< (vector-ref size root-i) (vector-ref size root-j))
        (let ((temp root-i))
          (set! root-i root-j)
          (set! root-j temp)))
      (vector-set! parent root-j root-i)
      (vector-set! size root-i (+ (vector-ref size root-i) (vector-ref size root-j))))))

(define (min-malware-spread initial graph)
  (let* ((n (vector-length graph))
         (parent (make-vector n (lambda (i) i)))
         (component-size-array (make-vector n 1)))

    (for* ((i (range n))
           (j (range (+ i 1) n)))
      (when (= (vector-ref (vector-ref graph i) j) 1)
        (union! parent component-size-array i j)))

    (define infected-count-map (make-hash))
    (for ((node initial))
      (let ((root (find! parent node)))
        (hash-set! infected-count-map root (+ (hash-ref infected-count-map root 0) 1))))

    (define max-saved -1)
    (define result (car (sort initial <)))

    (for ((u (sort initial <)))
      (let* ((root-u (find! parent u))
             (current-infected-in-component (hash-ref infected-count-map root-u 0))
             (current-component-total-size (vector-ref component-size-array root-u)))

        (define saved-nodes 0)
        (when (= current-infected-in-component 1)
          (set! saved-nodes current-component-total-size))

        (when (> saved-nodes max-saved)
          (set! max-saved saved-nodes)
          (set! result u))))

    result))