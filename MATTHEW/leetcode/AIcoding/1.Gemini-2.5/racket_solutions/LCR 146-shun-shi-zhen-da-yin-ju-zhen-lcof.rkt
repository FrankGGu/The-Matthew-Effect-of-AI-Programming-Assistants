(define (spiral-order matrix)
  (let* ((rows (length matrix))
         (cols (if (null? matrix) 0 (length (car matrix)))))
    (if (or (= rows 0) (= cols 0))
        '()
        (let loop ((top 0)
                   (bottom (- rows 1))
                   (left 0)
                   (right (- cols 1))
                   (result '()))
          (if (or (> top bottom) (> left right))
              result
              (let* ((segment1 (for/list ([c (range left (+ right 1))])
                                 (list-ref (list-ref matrix top) c)))
                     (new-result (append result segment1))
                     (new-top (+ top 1)))
                (if (> new-top bottom)
                    new-result
                    (let* ((segment2 (for/list ([r (range new-top (+ bottom 1))])
                                       (list-ref (list-ref matrix r) right)))
                           (new-result (append new-result segment2))
                           (new-right (- right 1)))
                      (if (> left new-right)
                          new-result
                          (let* ((segment3 (for/list ([c (range new-right (- left 1) -1)])
                                             (list-ref (list-ref matrix bottom) c)))
                                 (new-result (append new-result segment3))
                                 (new-bottom (- bottom 1)))
                            (if (> new-top new-bottom)
                                new-result
                                (let* ((segment4 (for/list ([r (range new-bottom (- new-top 1) -1)])
                                                   (list-ref (list-ref matrix r) left)))
                                       (new-result (append new-result segment4))
                                       (new-left (+ left 1)))
                                  (loop new-top new-bottom new-left new-right new-result))))))))))))