(define (total-hamming-distance nums)
  (let* ((n (length nums))
         (bit-count (make-vector 32 0)))
    (for* ((num nums)
           (i (range 32)))
      (when (positive? (bitwise-and num (arithmetic-shift 1 i)))
        (vector-set! bit-count i (add1 (vector-ref bit-count i)))))
    (for/sum ((i (range 32)))
      (* (vector-ref bit-count i) (- n (vector-ref bit-count i))))))