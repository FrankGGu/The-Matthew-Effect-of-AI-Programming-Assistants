(define (max-sum-after-partitioning arr k)
  (define n (length arr))
  (define dp (make-vector (add1 n) 0))
  (for ([i (in-range 1 (add1 n))])
    (define max-val 0)
    (for ([j (in-range 1 (add1 (min k i)))])
      (set! max-val (max max-val (list-ref arr (- i j))))
      (vector-set! dp i (max (vector-ref dp i) (+ (vector-ref dp (- i j)) (* j max-val)))))
    )
  (vector-ref dp n))