(define (has-all-codes s k)
  (let* ((n (string-length s))
         (needed (expt 2 k))
         (seen (make-hash)))
    (if (<= n k)
        (if (= needed 1) #t #f)
        (for ([i (- n k -1)])
          (let ((sub (substring s i (+ i k))))
            (hash-set! seen sub #t)))
        (>= (hash-count seen) needed))))