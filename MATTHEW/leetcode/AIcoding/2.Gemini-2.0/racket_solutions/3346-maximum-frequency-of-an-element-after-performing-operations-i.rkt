(define (max-frequency ops nums k)
  (define (solve nums k)
    (let* ((n (length nums))
           (sorted-nums (sort nums <))
           (left 0)
           (right 0)
           (total 0)
           (result 0))
      (while (< right n)
        (set! total (+ total (list-ref sorted-nums right)))
        (while (> (* (+ right 1) (- left)) (+ total k))
          (set! total (- total (list-ref sorted-nums left)))
          (set! left (+ left 1)))
        (set! result (max result (- right left 1)))
        (set! right (+ right 1)))
      result))

  (solve nums k))