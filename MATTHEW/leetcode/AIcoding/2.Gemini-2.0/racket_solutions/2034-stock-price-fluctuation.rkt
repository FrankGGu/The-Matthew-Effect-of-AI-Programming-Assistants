(define (StockPrice)
  (let ([prices (make-hash)]
        [max-timestamp -1]
        [min-heap (mutable-priority-queue <)]
        [max-heap (mutable-priority-queue >)])
    (define (update timestamp price)
      (hash-set! prices timestamp price)
      (when (> timestamp max-timestamp)
        (set! max-timestamp timestamp))
      (enqueue! min-heap (cons price timestamp))
      (enqueue! max-heap (cons price timestamp)))
    (define (current)
      (hash-ref prices max-timestamp))
    (define (maximum)
      (let loop ()
        (let ([p (peek max-heap)])
          (if (equal? (hash-ref prices (cdr p)) (car p))
              (car p)
              (dequeue! max-heap)
              (loop)))))
    (define (minimum)
      (let loop ()
        (let ([p (peek min-heap)])
          (if (equal? (hash-ref prices (cdr p)) (car p))
              (car p)
              (dequeue! min-heap)
              (loop)))))
    (struct stock-price (update current maximum minimum))
    (stock-price update current maximum minimum)))