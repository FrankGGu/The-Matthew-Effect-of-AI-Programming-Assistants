(define (average-of-levels root)
  (if (null? root)
      '()
      (let loop ([q (enqueue (make-queue) root)] [result '()])
        (if (queue-empty? q)
            (reverse result)
            (let* ([level-size (queue-size q)]
                   [level-sum (let sum-loop ([i 0] [s 0])
                                 (if (= i level-size)
                                     s
                                     (let* ([node (queue-first q)]
                                            [q (dequeue q)])
                                       (sum-loop (+ i 1) (+ s (car node)))
                                       (let add-children ([q q])
                                         (if (cadr node)
                                             (let ([q (enqueue q (cadr node))])
                                               q)
                                             q))
                                       (let add-children ([q q])
                                         (if (caddr node)
                                             (let ([q (enqueue q (caddr node))])
                                               q)
                                             q))
                                       )))])
              (loop q (cons (/ level-sum level-size) result)))))))