(define (num-triplets nums1 nums2)
  (let* ((n1 (length nums1))
         (n2 (length nums2))
         (count 0))
    (define (count-type1)
      (for* ((i (in-range n1)))
        (let ((target (* (list-ref nums1 i) (list-ref nums1 i))))
          (let ((m (make-hash)))
            (for ((j (in-range n2)))
              (hash-update! m (list-ref nums2 j) add1 0))
            (for ((j (in-range n2)))
              (let ((val (list-ref nums2 j)))
                (when (and (not (= val 0)) (integer? (/ target val)) (hash-has-key? m (/ target val)))
                  (let ((other (/ target val)))
                    (if (= val other)
                        (set! count (+ count (sub1 (hash-ref m val))))
                        (set! count (+ count (hash-ref m other))))))))))))
    (define (count-type2)
      (for* ((i (in-range n2)))
        (let ((target (* (list-ref nums2 i) (list-ref nums2 i))))
          (let ((m (make-hash)))
            (for ((j (in-range n1)))
              (hash-update! m (list-ref nums1 j) add1 0))
            (for ((j (in-range n1)))
              (let ((val (list-ref nums1 j)))
                (when (and (not (= val 0)) (integer? (/ target val)) (hash-has-key? m (/ target val)))
                  (let ((other (/ target val)))
                    (if (= val other)
                        (set! count (+ count (sub1 (hash-ref m val))))
                        (set! count (+ count (hash-ref m other))))))))))))
    (count-type1)
    (count-type2)
    (/ count 2)))