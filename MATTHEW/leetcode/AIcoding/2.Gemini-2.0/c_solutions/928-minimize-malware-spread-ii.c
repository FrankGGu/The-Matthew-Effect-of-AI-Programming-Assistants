#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int minMalwareSpread(int** graph, int graphSize, int* graphColSize, int* initial, int initialSize) {
    int n = graphSize;
    int min_spread = n + 1;
    int best_node = -1;

    for (int node_to_remove_idx = 0; node_to_remove_idx < initialSize; node_to_remove_idx++) {
        int node_to_remove = initial[node_to_remove_idx];

        bool infected[n];
        for (int i = 0; i < n; i++) {
            infected[i] = false;
        }

        int num_infected = 0;
        int queue[n];
        int head = 0, tail = 0;

        for (int i = 0; i < initialSize; i++) {
            if (initial[i] != node_to_remove) {
                int start_node = initial[i];
                if (!infected[start_node]) {
                    queue[tail++] = start_node;
                    infected[start_node] = true;
                    num_infected++;
                }
            }
        }

        while (head < tail) {
            int u = queue[head++];
            for (int v = 0; v < n; v++) {
                if (graph[u][v] == 1 && !infected[v]) {
                    queue[tail++] = v;
                    infected[v] = true;
                    num_infected++;
                }
            }
        }

        if (num_infected < min_spread) {
            min_spread = num_infected;
            best_node = node_to_remove;
        } else if (num_infected == min_spread) {
            if (best_node == -1 || node_to_remove < best_node) {
                best_node = node_to_remove;
            }
        }
    }

    if (best_node == -1) {
        int min_initial = initial[0];
        for (int i = 1; i < initialSize; i++) {
            if (initial[i] < min_initial) {
                min_initial = initial[i];
            }
        }
        return min_initial;
    }

    return best_node;
}