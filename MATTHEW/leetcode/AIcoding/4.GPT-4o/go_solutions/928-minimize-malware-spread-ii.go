package main

import (
	"sort"
)

func minMalwareSpread(graph [][]int, initial []int) int {
	n := len(graph)
	visited := make([]bool, n)
	colors := make([]int, n)
	colorCount := make(map[int]int)
	colorMalware := make(map[int]map[int]struct{})

	var dfs func(node, color int)
	dfs = func(node, color int) {
		visited[node] = true
		colors[node] = color
		colorCount[color]++
		if colorMalware[color] == nil {
			colorMalware[color] = make(map[int]struct{})
		}
		colorMalware[color][node] = struct{}{}

		for i := 0; i < n; i++ {
			if graph[node][i] == 1 && !visited[i] {
				dfs(i, color)
			}
		}
	}

	for i := 0; i < n; i++ {
		if !visited[i] {
			dfs(i, i)
		}
	}

	malwareCount := make(map[int]int)
	for _, node := range initial {
		color := colors[node]
		malwareCount[color]++
	}

	sort.Ints(initial)

	var result int
	minAffected := n

	for _, node := range initial {
		color := colors[node]
		if malwareCount[color] == 1 {
			if colorCount[color] < minAffected {
				minAffected = colorCount[color]
				result = node
			} else if colorCount[color] == minAffected {
				result = min(result, node)
			}
		}
	}

	if result == 0 && minAffected == n {
		return initial[0]
	}
	return result
}