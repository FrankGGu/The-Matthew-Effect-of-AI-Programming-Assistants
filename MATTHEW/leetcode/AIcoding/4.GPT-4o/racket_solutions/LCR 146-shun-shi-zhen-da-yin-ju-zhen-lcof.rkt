(define (spiralOrder matrix)
  (define (spiral-helper top bottom left right result)
    (when (and (<= top bottom) (<= left right))
      (for ([i (in-range left right +1)])
        (set! result (append result (list (list-ref (list-ref matrix top) i)))))
      (set! top (+ top 1))
      (for ([i (in-range top bottom +1)])
        (set! result (append result (list (list-ref (list-ref matrix i right))))))
      (set! right (- right 1))
      (when (<= top bottom)
        (for ([i (in-range right left -1)])
          (set! result (append result (list (list-ref (list-ref matrix bottom) i)))))
        (set! bottom (- bottom 1)))
      (when (<= left right)
        (for ([i (in-range bottom top -1)])
          (set! result (append result (list (list-ref (list-ref matrix i left))))))
        (set! left (+ left 1)))
      (spiral-helper top bottom left right result)))

  (spiral-helper 0 (- (length matrix) 1) 0 (- (length (first matrix)) 1) '()))