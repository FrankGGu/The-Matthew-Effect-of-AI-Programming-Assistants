(define (manhattan-distance pieces)
  (define (distance p1 p2)
    (+ (abs (- (car p1) (car p2)))
       (abs (- (cadr p1) (cadr p2)))))
  (define (total-distance arrangement)
    (apply + (map (lambda (i) (distance (list i) (list (arrangement i)))) (range (length pieces)))))
  (define (permute lst)
    (if (null? lst)
        (list '())
        (apply append
               (map (lambda (x)
                      (map (lambda (y) (cons x y))
                           (permute (remove x lst))))
                    lst))))
  (apply + (map total-distance (permute pieces))))