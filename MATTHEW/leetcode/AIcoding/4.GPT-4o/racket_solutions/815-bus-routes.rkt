(define (num-bus-routes routes S T)
  (define (build-graph routes)
    (define graph (make-hash))
    (for-each (lambda (route)
                (for-each (lambda (stop)
                            (hash-set! graph stop (cons route (hash-ref graph stop '()))))
                          route))
              routes)
    graph)

  (define (bfs start target graph)
    (define queue (list (list start 0)))
    (define visited (make-hash))
    (hash-set! visited start #t)
    (let loop ()
      (if (null? queue)
          -1
          (let* ((current (car queue))
                 (stop (car current))
                 (count (cadr current))
                 (next-queue (cdr queue)))
            (if (equal? stop target)
                count
                (let ((routes (hash-ref graph stop '())))
                  (for-each (lambda (route)
                              (for-each (lambda (next-stop)
                                          (unless (hash-ref visited next-stop #f)
                                            (hash-set! visited next-stop #t)
                                            (set! next-queue (append next-queue (list (list next-stop (+ count 1))))))
                                          )
                                        route))
                            routes)
                  (loop)))))))

  (define graph (build-graph routes))
  (bfs S T graph))

(define (busRoutes routes S T)
  (num-bus-routes routes S T))