class Solution {
public:
    int minMalwareSpread(vector<vector<int>>& graph, vector<int>& initial) {
        int n = graph.size();
        sort(initial.begin(), initial.end());
        vector<int> parent(n), size(n, 1);
        iota(parent.begin(), parent.end(), 0);

        function<int(int)> find = [&](int x) {
            return parent[x] == x ? x : parent[x] = find(parent[x]);
        };

        for (int u : initial) {
            for (int v = 0; v < n; v++) {
                if (graph[u][v]) {
                    parent[find(v)] = find(u);
                }
            }
        }

        vector<int> count(n);
        for (int u : initial) {
            count[find(u)]++;
        }

        int answer = -1, maxCount = 0;
        vector<bool> isMalware(n, false);
        for (int u : initial) {
            isMalware[find(u)] = true;
        }

        for (int u : initial) {
            if (!isMalware[find(u)]) continue;
            if (count[find(u)] > maxCount || (count[find(u)] == maxCount && u < answer)) {
                maxCount = count[find(u)];
                answer = u;
            }
        }

        return answer == -1 ? initial[0] : answer;
    }
};