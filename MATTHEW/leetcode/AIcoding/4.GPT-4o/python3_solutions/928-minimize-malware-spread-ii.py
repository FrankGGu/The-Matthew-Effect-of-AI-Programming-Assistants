class Solution:
    def minMalwareSpread(self, graph: List[List[int]], initial: List[int]) -> int:
        from collections import defaultdict, deque

        n = len(graph)
        initial_set = set(initial)
        visited = [False] * n
        malware_count = [0] * n
        components = []

        def bfs(start):
            queue = deque([start])
            visited[start] = True
            component = []
            while queue:
                node = queue.popleft()
                component.append(node)
                for neighbor in range(n):
                    if graph[node][neighbor] == 1 and not visited[neighbor]:
                        visited[neighbor] = True
                        queue.append(neighbor)
            return component

        for i in range(n):
            if not visited[i]:
                component = bfs(i)
                components.append(component)

        for component in components:
            infected = [node for node in component if node in initial_set]
            if len(infected) == 1:
                malware_count[infected[0]] += 1

        min_node = min(initial)
        max_count = -1
        for node in initial:
            if malware_count[node] > max_count or (malware_count[node] == max_count and node < min_node):
                max_count = malware_count[node]
                min_node = node

        return min_node