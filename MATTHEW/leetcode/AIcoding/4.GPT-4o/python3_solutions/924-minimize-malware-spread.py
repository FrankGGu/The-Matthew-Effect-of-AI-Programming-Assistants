class Solution:
    def minMalwareSpread(self, graph: List[List[int]], initial: List[int]) -> int:
        from collections import defaultdict, deque

        def bfs(node, visited):
            queue = deque([node])
            visited.add(node)
            component = []
            while queue:
                curr = queue.popleft()
                component.append(curr)
                for neighbor in range(len(graph)):
                    if graph[curr][neighbor] == 1 and neighbor not in visited:
                        visited.add(neighbor)
                        queue.append(neighbor)
            return component

        initial_set = set(initial)
        components = []
        visited = set()

        for i in range(len(graph)):
            if i not in visited:
                component = bfs(i, visited)
                components.append(component)

        malware_count = defaultdict(int)

        for node in initial:
            for comp in components:
                if node in comp:
                    for n in comp:
                        malware_count[n] += 1

        min_node = float('inf')
        min_count = float('inf')

        for node in initial:
            if malware_count[node] == 1:
                if node < min_node:
                    min_node = node

        if min_node != float('inf'):
            return min_node

        return min(initial)