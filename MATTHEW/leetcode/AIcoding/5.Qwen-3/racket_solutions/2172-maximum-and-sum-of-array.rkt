(define (max-and-sum nums)
  (define n (length nums))
  (define dp (make-vector (expt 2 n) 0))
  (for ([i (in-range (expt 2 n))])
    (when (bitwise-bit-set? i 0)
      (vector-set! dp i (vector-ref dp (bitwise-xor i 1))))
    (for ([j (in-range 1 n)])
      (when (bitwise-bit-set? i j)
        (define prev (bitwise-xor i (arithmetic-shift 1 j)))
        (define val (bitwise-and (vector-ref dp prev) (vector-ref nums j)))
        (vector-set! dp i (max (vector-ref dp i) (+ (vector-ref dp prev) val)))))
  (vector-ref dp (- (expt 2 n) 1)))