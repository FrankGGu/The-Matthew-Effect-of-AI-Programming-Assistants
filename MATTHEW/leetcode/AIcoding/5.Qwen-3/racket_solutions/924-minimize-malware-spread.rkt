#lang racket

(define (minimize-malware-spread grid initial)
  (define n (length grid))
  (define (dfs i visited)
    (cond [(hash-has-key? visited i) #f]
          [else
           (hash-set! visited i #t)
           (for/and ([j (in-range n)])
             (if (and (not (hash-has-key? visited j)) (= (list-ref (list-ref grid i) j) 1))
                 (dfs j visited)
                 #t))]))

  (define (count-infected)
    (define visited (make-hash))
    (for/fold ([cnt 0]) ([i (in-list initial)])
      (when (dfs i visited)
        (set! cnt (+ cnt 1)))
      cnt))

  (define (simulate i)
    (define visited (make-hash))
    (for/fold ([cnt 0]) ([j (in-list initial)])
      (when (not (= j i))
        (when (dfs j visited)
          (set! cnt (+ cnt 1))))
      cnt))

  (define min-infected (count-infected))
  (define result 0)
  (for ([i (in-list initial)])
    (define new-infected (simulate i))
    (when (< new-infected min-infected)
      (set! min-infected new-infected)
      (set! result i)))
  result)