#lang racket

(define (get-biggest-three-rhombus-sums grid)
  (define rows (length grid))
  (define cols (length (car grid)))
  (define max-sum -inf.0)
  (define second-max -inf.0)
  (define third-max -inf.0)

  (define (update-max a b c x)
    (cond [(> x a) (values x a b)]
          [(> x b) (values a x b)]
          [(> x c) (values a b x)]
          [else (values a b c)]))

  (for ([i (in-range rows)])
    (for ([j (in-range cols)])
      (let loop ([k 1])
        (when (<= (+ i k) rows)
          (when (<= (- j k) -1) (void))
          (when (<= (+ j k) cols)
            (let ([sum 0])
              (let ([di i] [dj j])
                (do ([d 0 (+ d 1)])
                    ([= d k])
                  (set! sum (+ sum (list-ref (list-ref grid di) dj)))
                  (set! di (+ di 1))
                  (set! dj (- dj 1))))
              (set! sum (+ sum (list-ref (list-ref grid i) j)))
              (let ([di i] [dj j])
                (do ([d 0 (+ d 1)])
                    ([= d k])
                  (set! sum (+ sum (list-ref (list-ref grid di) dj)))
                  (set! di (+ di 1))
                  (set! dj (+ dj 1))))
              (let ([di i] [dj j])
                (do ([d 0 (+ d 1)])
                    ([= d k])
                  (set! sum (+ sum (list-ref (list-ref grid di) dj)))
                  (set! di (- di 1))
                  (set! dj (+ dj 1))))
              (let ([di i] [dj j])
                (do ([d 0 (+ d 1)])
                    ([= d k])
                  (set! sum (+ sum (list-ref (list-ref grid di) dj)))
                  (set! di (- di 1))
                  (set! dj (- dj 1))))
              (set! sum (+ sum (list-ref (list-ref grid i) j)))
              (set! max-sum (max max-sum sum))
              (set! second-max (max second-max sum))
              (set! third-max (max third-max sum))
              (loop (+ k 1)))))))

  (define (get-max a b c)
    (list a b c))

  (define sorted (sort (get-max max-sum second-max third-max) >))
  (take sorted 3))