(define (regions-examined grid)
  (define rows (length grid))
  (define cols (if (> rows 0) (length (car grid)) 0))
  (define visited (make-vector rows (make-vector cols #f)))
  (define result (make-vector rows (make-vector cols 0)))

  (define (dfs r c)
    (when (and (<= 0 r rows) (<= 0 c cols) (not (vector-ref (vector-ref visited r) c)))
      (vector-set! (vector-ref visited r) c #t)
      (let loop ([sum 0] [count 0] [r r] [c c])
        (if (or (>= r rows) (< r 0) (>= c cols) (< c 0) (vector-ref (vector-ref visited r) c))
            (values sum count)
            (begin
              (vector-set! (vector-ref visited r) c #t)
              (loop (+ sum (vector-ref (vector-ref grid r) c))
                    (+ count 1)
                    (+ r 1)
                    c)
              (loop (+ sum (vector-ref (vector-ref grid r) c))
                    (+ count 1)
                    (- r 1)
                    c)
              (loop (+ sum (vector-ref (vector-ref grid r) c))
                    (+ count 1)
                    r
                    (+ c 1))
              (loop (+ sum (vector-ref (vector-ref grid r) c))
                    (+ count 1)
                    r
                    (- c 1)))))))

  (for ([r (in-range rows)])
    (for ([c (in-range cols)])
      (when (not (vector-ref (vector-ref visited r) c))
        (define-values (sum count) (dfs r c))
        (for ([i (in-range rows)])
          (for ([j (in-range cols)])
            (when (and (not (vector-ref (vector-ref visited i) j)) (equal? (vector-ref (vector-ref visited i) j) #t))
              (vector-set! (vector-ref result i) j (/ sum count)))))))
  (vector->list result))