(define (unique-paths-iii grid)
  (define rows (length grid))
  (define cols (length (car grid)))
  (define start (for/first ([i (in-range rows)] [row grid] #:when (member 1 row) #:return i) i))
  (define start-col (for/first ([j (in-range cols)] #:when (= (list-ref (list-ref grid start) j) 1) #:return j))
  (define target (for/first ([i (in-range rows)] [row grid] #:when (member 2 row) #:return i) i))
  (define target-col (for/first ([j (in-range cols)] #:when (= (list-ref (list-ref grid target) j) 2) #:return j))
  (define visited (make-hash))
  (define (mark-visited x y)
    (hash-set! visited (cons x y) #t))
  (define (is-visited? x y)
    (hash-has-key? visited (cons x y)))
  (define (is-valid x y)
    (and (<= 0 x (- rows 1)) (<= 0 y (- cols 1)) (not (is-visited? x y)) (not (= (list-ref (list-ref grid x) y) -1))))
  (define count 0)
  (define (dfs x y steps)
    (when (and (= x target) (= y target-col))
      (set! count (+ count 1))
      (void))
    (for-each (lambda (dx dy)
                (let ([nx (+ x dx)] [ny (+ y dy)])
                  (when (is-valid nx ny)
                    (mark-visited nx ny)
                    (dfs nx ny (+ steps 1))
                    (hash-remove! visited (cons nx ny)))))
              '(-1 0 1 0) '(-1 0 1 0)))
  (mark-visited start start-col)
  (dfs start start-col 1)
  count)