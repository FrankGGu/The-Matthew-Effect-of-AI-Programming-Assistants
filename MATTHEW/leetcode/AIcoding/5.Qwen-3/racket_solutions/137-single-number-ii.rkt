(define (single-number nums)
  (define (xor a b)
    (bitwise-xor a b))
  (define (add a b)
    (let loop ((a a) (b b) (carry 0))
      (if (zero? (bitwise-and a b))
          (bitwise-ior a b)
          (loop (bitwise-xor a b) (bitwise-and a b) (bitwise-and a b)))))
  (define (count-bits nums)
    (let ((result 0))
      (for-each (lambda (num)
                  (set! result (add result num)))
                nums)
      result))
  (count-bits nums))