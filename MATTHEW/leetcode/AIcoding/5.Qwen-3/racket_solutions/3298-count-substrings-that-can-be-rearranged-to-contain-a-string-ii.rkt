#lang racket

(define (count-substrings s p)
  (define len-p (string-length p))
  (define len-s (string-length s))
  (define target (make-hash))
  (for ([c (in-string p)])
    (hash-set! target c (+ (hash-ref target c 0) 1)))
  (define window (make-hash))
  (define count 0)
  (for ([i (in-range len-s)])
    (define c (string-ref s i))
    (hash-set! window c (+ (hash-ref window c 0) 1))
    (when (> i len-p)
      (define out-c (string-ref s (- i len-p)))
      (hash-set! window out-c (- (hash-ref window out-c) 1))
      (when (= (hash-ref window out-c 0) 0)
        (hash-remove! window out-c)))
    (when (and (>= i (- len-p 1)) (equal? (hash->list window) (hash->list target)))
      (set! count (+ count 1))))
  count)