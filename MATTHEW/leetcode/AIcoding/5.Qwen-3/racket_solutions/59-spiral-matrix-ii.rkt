(define (generate-matrix n)
  (define matrix (make-vector n))
  (for ([i (in-range n)])
    (vector-set! matrix i (make-vector n 0)))
  (define dir (vector (cons 0 1) (cons 1 0) (cons 0 -1) (cons -1 0)))
  (define current-dir 0)
  (define x 0)
  (define y 0)
  (define count 1)
  (for ([i (in-range (* n n))])
    (vector-set! (vector-ref matrix x) y count)
    (set! count (+ count 1))
    (define next-x (+ x (car (vector-ref dir current-dir))))
    (define next-y (+ y (cdr (vector-ref dir current-dir))))
    (when (or (< next-x 0) (>= next-x n) (< next-y 0) (>= next-y n) (not (= (vector-ref (vector-ref matrix next-x) next-y) 0)))
      (set! current-dir (modulo (+ current-dir 1) 4))
      (set! next-x (+ x (car (vector-ref dir current-dir))))
      (set! next-y (+ y (cdr (vector-ref dir current-dir)))))
    (set! x next-x)
    (set! y next-y))
  (vector->list matrix))