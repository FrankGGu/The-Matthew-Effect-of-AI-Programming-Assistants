(define (surface-area grid)
  (define (get-value x y)
    (if (and (<= 0 x (sub1 (length grid))) (<= 0 y (sub1 (length (car grid)))))
        (list-ref (list-ref grid x) y)
        0))
  (define (neighbors x y)
    (map (lambda (d) (get-value (+ x (car d)) (+ y (cadr d))))
         '((0 1) (1 0) (0 -1) (-1 0))))
  (define (area x y)
    (let ((v (get-value x y)))
      (if (= v 0)
          0
          (let ((n (neighbors x y)))
            (+ (* 2 v)
               (apply - (map (lambda (nv) (max 0 (- v nv))) n))))))
  (define (sum-areas)
    (let loop ((i 0) (total 0))
      (if (>= i (length grid))
          total
          (loop (+ i 1) (+ total (sum (map (lambda (j) (area i j)) (range 0 (length (car grid))))))))))
  (sum-areas))