#lang racket

(define (count-beautiful-substrings s)
  (define n (string-length s))
  (define vowels #(#\a #\e #\i #\o #\u))
  (define (is-vowel c)
    (member c vowels))
  (define (count-palindromes s)
    (define n (string-length s))
    (define dp (make-vector n (make-vector n #f)))
    (for ([i (in-range n)])
      (vector-set! dp i i #t)
      (when (< i (- n 1))
        (vector-set! dp i (+ i 1) (= (string-ref s i) (string-ref s (+ i 1))))))
    (for ([length (in-range 2 n)])
      (for ([i (in-range 0 (- n length))])
        (define j (+ i length))
        (vector-set! dp i j (= (string-ref s i) (string-ref s j))
                     (vector-ref (vector-ref dp i (+ j 1)) (vector-ref dp (+ i 1) j)))))
    (for/sum ([i (in-range n)]
              [j (in-range i n)])
      (if (vector-ref (vector-ref dp i j) #t) 1 0)))
  (define (solve)
    (define result 0)
    (for ([i (in-range n)])
      (for ([j (in-range i n)])
        (define substr (substring s i (+ j 1)))
        (define len (string-length substr))
        (when (and (even? len)
                   (is-vowel (string-ref substr 0))
                   (is-vowel (string-ref substr (sub1 len)))
                   (count-palindromes substr))
          (set! result (+ result 1)))))
    result)
  (solve))