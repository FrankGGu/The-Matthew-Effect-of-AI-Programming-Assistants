(define (number-of-weak-characters players)
  (define (compare a b)
    (if (= (car a) (car b))
        (> (cadr a) (cadr b))
        (< (car a) (car b))))
  (define sorted (sort players compare))
  (define-values (max-def weak-count)
    (for/fold ([max-def -1] [weak-count 0])
              ([p sorted])
      (if (< (cadr p) max-def)
          (values max-def (+ weak-count 1))
          (values (cadr p) weak-count))))
  weak-count)