#lang racket

(define (possible-bipartition n dislikes)
  (define graph (make-hash))
  (for ([i (in-range 1 (add1 n))])
    (hash-set! graph i '()))
  (for ([d (in-list dislikes)])
    (define u (car d))
    (define v (cadr d))
    (hash-set! graph u (cons v (hash-ref graph u)))
    (hash-set! graph v (cons u (hash-ref graph v))))
  (define color (make-hash))
  (define (dfs u c)
    (when (hash-has-key? color u)
      (if (= (hash-ref color u) c) #t #f))
    (hash-set! color u c)
    (for ([v (hash-ref graph u)])
      (when (not (dfs v (- 1 c)))
        #f))
    #t)
  (for ([i (in-range 1 (add1 n))])
    (when (not (hash-has-key? color i))
      (when (not (dfs i 0))
        #f)))
  #t)