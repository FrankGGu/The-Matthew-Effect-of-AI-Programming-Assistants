(define (reachable-nodes-with-restrictions n edges restricted)
  (define adj (make-hash))
  (for-each (lambda (e)
              (let ([u (car e)] [v (cadr e)])
                (hash-set! adj u (cons v (hash-ref adj u '())))
                (hash-set! adj v (cons u (hash-ref adj v '())))))
            edges)
  (define visited (make-hash))
  (define (dfs node)
    (when (and (not (hash-has-key? visited node)) (not (member node restricted)))
      (hash-set! visited node #t)
      (for-each dfs (hash-ref adj node))))
  (dfs 0)
  (hash-count visited))