(define (robot-sim-ii commands obstacles)
  (define directions '((0 1) (1 0) (0 -1) (-1 0)))
  (define (turn-left dir)
    (modulo (- dir 1) 4))
  (define (move x y dir steps)
    (let loop ((i 0) (x x) (y y))
      (if (>= i steps)
          (values x y)
          (let ((nx (+ x (car (list-ref directions dir))))
                (ny (+ y (cadr (list-ref directions dir)))))
            (if (member (list nx ny) obstacles)
                (values x y)
                (loop (+ i 1) nx ny))))))
  (let loop ((x 0) (y 0) (dir 0) (max-x 0) (max-y 0))
    (if (null? commands)
        (max max-x max-y)
        (let ((cmd (car commands)))
          (if (= cmd 1)
              (let-values (((x y) (move x y dir (cadr commands))))
                (loop x y dir (max max-x x) (max max-y y)))
              (loop x y (turn-left dir) max-x max-y))))))