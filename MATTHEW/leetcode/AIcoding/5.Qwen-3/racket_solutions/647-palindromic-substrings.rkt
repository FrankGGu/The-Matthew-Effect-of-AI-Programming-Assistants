(define (count-palindromes s)
  (define n (string-length s))
  (define count 0)
  (define (expand l r)
    (let loop ()
      (when (and (>= l 0) (< r n) (char=? (string-ref s l) (string-ref s r)))
        (set! count (+ count 1))
        (loop (- l 1) (+ r 1)))))
  (for ([i (in-range n)])
    (expand i i)
    (expand i (+ i 1)))
  count)