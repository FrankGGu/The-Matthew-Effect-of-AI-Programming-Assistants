(define (max-subsequence-length nums)
  (define dp (make-hash))
  (define (dfs i prev)
    (if (>= i (length nums))
        0
        (let ((key (cons i prev)))
          (if (hash-has-key? dp key)
              (hash-ref dp key)
              (let* ((current (list-ref nums i))
                     (res (if (= current prev)
                              (dfs (+ i 1) prev)
                              (max (dfs (+ i 1) prev)
                                   (+ 1 (dfs (+ i 1) current))))))
                (hash-set! dp key res)
                res)))))
  (dfs 0 -1))