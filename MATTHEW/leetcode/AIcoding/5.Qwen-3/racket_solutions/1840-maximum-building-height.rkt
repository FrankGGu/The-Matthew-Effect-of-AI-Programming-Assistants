#lang racket

(define (maximum-building-height n directions)
  (define dir (map (lambda (d) (cons (car d) (cdr d))) directions))
  (define left (make-hash))
  (define right (make-hash))
  (for-each (lambda (d)
              (hash-set! left (car d) (max (hash-ref left (car d) 0) (cdr d))))
            dir)
  (for-each (lambda (d)
              (hash-set! right (car d) (max (hash-ref right (car d) 0) (cdr d))))
            dir)
  (define (get-left i)
    (if (hash-has-key? left i)
        (hash-ref left i)
        0))
  (define (get-right i)
    (if (hash-has-key? right i)
        (hash-ref right i)
        0))
  (define res (make-vector n 0))
  (for ([i (in-range n)])
    (vector-set! res i (min (get-left i) (get-right i))))
  (for ([i (in-range 1 n)])
    (vector-set! res i (min (vector-ref res i) (+ (vector-ref res (- i 1)) 1))))
  (for ([i (in-range (- n 2) -1 -1)])
    (vector-set! res i (min (vector-ref res i) (+ (vector-ref res (+ i 1)) 1))))
  (apply max (vector->list res)))