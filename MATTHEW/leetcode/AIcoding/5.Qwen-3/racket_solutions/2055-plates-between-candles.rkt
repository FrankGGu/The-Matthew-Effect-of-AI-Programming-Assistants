#lang racket

(define (plates-between-candles directions)
  (define n (string-length directions))
  (define left (make-vector n -1))
  (define right (make-vector n -1))
  (define prefix (make-vector n 0))
  (let loop ([i 0] [last -1])
    (when (< i n)
      (vector-set! left i last)
      (when (= (string-ref directions i) #\*)
        (set! last i))
      (loop (+ i 1) last)))
  (let loop ([i (- n 1)] [last -1])
    (when (>= i 0)
      (vector-set! right i last)
      (when (= (string-ref directions i) #\*)
        (set! last i))
      (loop (- i 1) last)))
  (let loop ([i 0] [sum 0])
    (when (< i n)
      (vector-set! prefix i sum)
      (when (= (string-ref directions i) #\*)
        (set! sum (+ sum 1)))
      (loop (+ i 1) sum)))
  (define (query l r)
    (let ([left-candle (vector-ref left l)]
          [right-candle (vector-ref right r)])
      (if (or (= left-candle -1) (= right-candle -1) (> left-candle right-candle))
          0
          (- (vector-ref prefix right-candle) (vector-ref prefix left-candle)))))
  (define queries '((0 5) (2 7) (4 9)))
  (map (lambda (q) (query (car q) (cadr q))) queries))