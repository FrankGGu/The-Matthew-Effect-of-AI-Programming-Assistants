(define (robot-sim commands obstacles)
  (define directions '((0 1) (1 0) (0 -1) (-1 0)))
  (define (turn-left dir) (modulo (sub1 dir) 4))
  (define (turn-right dir) (modulo (add1 dir) 4))
  (define (move x y dir)
    (let ([dx (car (list-ref directions dir))]
          [dy (cadr (list-ref directions dir))])
      (values (+ x dx) (+ y dy))))
  (define (max-distance x y)
    (max (abs x) (abs y)))
  (define (obstacle? x y)
    (member (list x y) obstacles))
  (define (simulate x y dir steps)
    (if (null? steps)
        (max-distance x y)
        (let ([step (car steps)])
          (cond [(= step 1)
                 (let-values ([(nx ny) (move x y dir)])
                   (if (obstacle? nx ny)
                       (simulate x y dir (cdr steps))
                       (simulate nx ny dir (cdr steps))))]
                [(= step 2)
                 (simulate x y (turn-left dir) (cdr steps))]
                [(= step 3)
                 (simulate x y (turn-right dir) (cdr steps))]))))
  (simulate 0 0 0 commands))