(define (min-flips s)
  (let* ((n (string-length s))
         (s2 (string-append s s))
         (diff1 0)
         (diff2 0)
         (res +inf.0))
    (for ((i (in-range (* 2 n))))
      (let ((c (string-ref s2 i)))
        (when (>= i n)
          (let ((old-c (string-ref s2 (- i n))))
            (when (not (eq? old-c (if (even? (- i n)) #\0 #\1)))
              (set! diff1 (sub1 diff1)))
            (when (not (eq? old-c (if (even? (- i n)) #\1 #\0))
              (set! diff2 (sub1 diff2)))))
        (when (not (eq? c (if (even? i) #\0 #\1)))
          (set! diff1 (add1 diff1)))
        (when (not (eq? c (if (even? i) #\1 #\0)))
          (set! diff2 (add1 diff2)))
        (when (>= i (sub1 n))
          (set! res (min res diff1 diff2)))))
    (min res (quotient n 2))))